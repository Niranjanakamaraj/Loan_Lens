# Integration Setup Guide

This guide will help you integrate the XGBoost loan approval model with the frontend application.

## Architecture Overview

The application uses a **frontend-backend** architecture:

- **Frontend**: React/TypeScript with Vite (runs on `http://localhost:5173`)
- **Backend**: FastAPI server (runs on `http://localhost:8000`)
- **Model**: XGBoost loan approval classifier with SHAP explainability

## Prerequisites

- Python 3.8+ (for the backend)
- Node.js 16+ and npm/bun (for the frontend)
- The trained model file: `Model/loan_approval_model_tuned.pkl`

## Quick Start

### 1. Setup Backend (Python/FastAPI)

From the project root directory:

```bash
# Create a Python virtual environment
python -m venv .venv

# Activate it
# On Windows:
.venv\Scripts\activate
# On macOS/Linux:
source .venv/bin/activate

# Install dependencies
pip install -r Model/requirements.txt

# Run the API server
python Model/api_server.py
```

The API will start at `http://localhost:8000`

You can verify it's running by visiting: `http://localhost:8000/api/health`

API Documentation (Swagger UI): `http://localhost:8000/docs`

### 2. Setup Frontend (React/TypeScript)

In a new terminal, from the project root:

```bash
# Install dependencies
npm install
# or
bun install

# Create environment file
cp .env.example .env.local

# Start the development server
npm run dev
# or
bun dev
```

The frontend will open at `http://localhost:5173`

## Environment Configuration

Create a `.env.local` file in the root directory:

```
VITE_API_URL=http://localhost:8000
```

If you're deploying the backend elsewhere, update this URL accordingly.

## API Endpoints

### Health Check

```
GET /api/health
```

Returns: `{"ok": true}` if the API is running

### Prediction

```
POST /api/predict
Content-Type: application/json

{
  "gender": "Male" | "Female",
  "married": boolean,
  "dependents": "0" | "1" | "2" | "3+",
  "education": "Graduate" | "Not Graduate",
  "selfEmployed": boolean,
  "applicantIncome": number,
  "coapplicantIncome": number,
  "loanAmount": number,
  "loanTerm": number,
  "creditHistory": boolean,
  "propertyArea": "Urban" | "Semiurban" | "Rural"
}
```

Returns:

```json
{
  "approved": boolean,
  "probability": number,
  "riskLevel": "low" | "medium" | "high",
  "positiveFactors": [
    {
      "name": string,
      "impact": "strong" | "moderate" | "weak",
      "description": string,
      "positive": true,
      "shapValue": number
    }
  ],
  "negativeFactors": [
    {
      "name": string,
      "impact": "strong" | "moderate" | "weak",
      "description": string,
      "positive": false,
      "shapValue": number
    }
  ]
}
```

## Features

### AI Model

- **Type**: XGBoost Classifier
- **Input Features**: 11 features (gender, income, loan amount, credit history, etc.)
- **Feature Engineering**: EMI ratio, total income computed from applicant and co-applicant income
- **Explainability**: SHAP (SHapley Additive exPlanations) values explain each prediction

### Frontend Features

- Real-time form validation
- Visual decision indicators (approved/rejected)
- Risk level assessment (low/medium/high)
- Factor analysis with SHAP-based explanations
- Positive and negative factors clearly separated
- Fallback simulation mode when API is unavailable

## Troubleshooting

### "Cannot connect to API" error

1. Make sure the backend is running: `python Model/api_server.py`
2. Check that `VITE_API_URL` in `.env.local` is correct
3. Ensure both services are on the same network if using Docker/remote servers

### Model file not found

- Ensure `Model/loan_approval_model_tuned.pkl` exists in the Model directory
- The model file should be generated by running `Model/train_loan_model_xgboost.py`

### CORS errors

- The FastAPI backend has CORS enabled for all origins by default
- If you need to restrict it, modify the CORS configuration in `Model/api_server.py`

### Dependency issues

- Run `pip install -r Model/requirements.txt` to ensure all Python packages are installed
- Run `npm install` or `bun install` to ensure all Node dependencies are installed

## Development Workflow

1. **Terminal 1 - Backend**:

   ```bash
   .venv\Scripts\activate
   python Model/api_server.py
   ```

2. **Terminal 2 - Frontend**:

   ```bash
   npm run dev
   ```

3. Open browser to `http://localhost:5173`

4. Make changes to frontend code → auto-reload in browser
5. Make changes to backend code → restart the API server

## Production Deployment

For production, you'll need to:

1. Build the frontend: `npm run build`
2. Deploy the built files to a web server (Netlify, Vercel, AWS S3, etc.)
3. Deploy the FastAPI backend to a server (AWS Lambda, Render, Railway, etc.)
4. Update `VITE_API_URL` to point to your production backend

## File Structure

```
neon-credit-ai/
├── src/
│   ├── pages/
│   │   └── Index.tsx          # Main page with integration
│   ├── components/
│   │   ├── loan-form/
│   │   │   └── LoanFormPanel.tsx
│   │   └── results/
│   │       ├── DecisionPanel.tsx
│   │       ├── ExplainabilityPanel.tsx
│   │       └── ...
│   └── services/
│       └── loanApi.ts          # API client (NEW)
├── Model/
│   ├── api_server.py           # FastAPI backend
│   ├── train_loan_model_xgboost.py
│   ├── requirements.txt
│   └── loan_approval_model_tuned.pkl
├── .env.example                # Environment template (NEW)
└── ...
```

## Next Steps

1. ✅ API client service created (`src/services/loanApi.ts`)
2. ✅ Frontend integrated with real API calls
3. ✅ Environment configuration ready
4. **Run the backend**: `python Model/api_server.py`
5. **Run the frontend**: `npm run dev`
6. Test the loan form to see real predictions!
