import { FileText, Download, BookOpen } from "lucide-react";
import GlassCard from "../GlassCard";
import NeonButton from "../NeonButton";
import { LoanFormData } from "../loan-form/LoanFormPanel";
import { PredictResponse } from "@/services/loanApi";

interface ReportCenterProps {
  formData: LoanFormData;
  predictions: PredictResponse;
}

const ReportCenter = ({ formData, predictions }: ReportCenterProps) => {
  const generateAIAnalysisReport = () => {
    const content = `
NEON CREDIT AI - LOAN ANALYSIS REPORT
=====================================
Generated on: ${new Date().toLocaleString()}

APPLICANT PROFILE
-----------------
Gender: ${formData.gender}
Marital Status: ${formData.married ? "Married" : "Single"}
Dependents: ${formData.dependents}
Education: ${formData.education}
Employment: ${formData.selfEmployed ? "Self-Employed" : "Employed"}
Property Area: ${formData.propertyArea}

FINANCIAL PROFILE
-----------------
Applicant Income: $${formData.applicantIncome.toLocaleString()}
Co-applicant Income: $${formData.coapplicantIncome.toLocaleString()}
Total Income: $${(formData.applicantIncome + formData.coapplicantIncome).toLocaleString()}
Loan Amount: $${formData.loanAmount.toLocaleString()}
Loan Term: ${formData.loanTerm} months
Credit History: ${formData.creditHistory ? "Good" : "Poor"}

AI ANALYSIS RESULTS
-------------------
Decision: ${predictions.approved ? "APPROVED ✓" : "REJECTED ✗"}
Approval Probability: ${predictions.probability}%
Risk Level: ${predictions.riskLevel.toUpperCase()}

POSITIVE FACTORS (${predictions.positiveFactors.length})
${predictions.positiveFactors.map(f => `• ${f.name} (${f.impact}) - ${f.description}`).join("\n")}

NEGATIVE FACTORS (${predictions.negativeFactors.length})
${predictions.negativeFactors.map(f => `• ${f.name} (${f.impact}) - ${f.description}`).join("\n")}

RECOMMENDATION
---------------
${predictions.approved 
  ? "Your loan application has been approved by our AI model with a strong probability score. Please proceed with the next steps."
  : "Your application did not meet the approval criteria. Consider improving the factors listed above and reapply."}

Report generated by Neon Credit AI
Powered by XGBoost Machine Learning Model
    `.trim();
    
    return content;
  };

  const generateGuidanceReport = () => {
    const content = `
NEON CREDIT AI - PERSONALIZED GUIDANCE REPORT
==============================================
Generated on: ${new Date().toLocaleString()}

EXECUTIVE SUMMARY
------------------
Based on your profile and our AI analysis, here are personalized recommendations to improve your loan approval chances.

CURRENT STATUS
---------------
Approval Probability: ${predictions.probability}%
Risk Assessment: ${predictions.riskLevel.toUpperCase()}

POSITIVE FACTORS TO MAINTAIN
------------------------------
${predictions.positiveFactors.length > 0 
  ? predictions.positiveFactors.map(f => `✓ ${f.name}\n  "${f.description}"\n  Impact Level: ${f.impact}\n`).join("\n")
  : "No positive factors identified yet."}

AREAS FOR IMPROVEMENT
----------------------
${predictions.negativeFactors.length > 0 
  ? predictions.negativeFactors.map(f => `• ${f.name}\n  Issue: ${f.description}\n  Priority: ${f.impact}\n`).join("\n")
  : "No negative factors identified."}

ACTIONABLE RECOMMENDATIONS
---------------------------
1. INCOME OPTIMIZATION
   - Focus on maintaining stable employment
   - Consider increasing co-applicant income if possible
   - Document all sources of income

2. CREDIT MANAGEMENT
   - Ensure timely payment of all bills
   - Maintain good credit history records
   - Address any outstanding credit issues

3. LOAN PLANNING
   - Review your loan amount in relation to income
   - Consider extending the loan term if needed
   - Plan for EMI affordability

4. DOCUMENTATION
   - Prepare complete financial documentation
   - Gather proof of employment and income
   - Organize property-related documents

NEXT STEPS
----------
1. Review the feedback provided above
2. Address the areas flagged for improvement
3. Consider reapplication once improvements are made
4. Keep all necessary documentation ready

For more information, please contact our support team.

Report generated by Neon Credit AI
Personalized guidance powered by advanced analytics
    `.trim();
    
    return content;
  };

  const handleDownload = (reportType: "ai" | "guidance") => {
    let content = "";
    let filename = "";

    if (reportType === "ai") {
      content = generateAIAnalysisReport();
      filename = `AI_Analysis_Report_${new Date().getTime()}.txt`;
    } else if (reportType === "guidance") {
      content = generateGuidanceReport();
      filename = `Personalized_Guidance_${new Date().getTime()}.txt`;
    }

    // Create blob and download
    const element = document.createElement("a");
    const file = new Blob([content], { type: "text/plain" });
    element.href = URL.createObjectURL(file);
    element.download = filename;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
    URL.revokeObjectURL(element.href);
  };

  const reports = [
    {
      icon: FileText,
      title: "AI Analysis Report",
      description: "Complete loan analysis with decision details",
      format: "TXT",
      color: "blue" as const,
      type: "ai" as const,
    },
    {
      icon: BookOpen,
      title: "Personalized Guidance",
      description: "Personalized improvement recommendations",
      format: "TXT",
      color: "purple" as const,
      type: "guidance" as const,
    },
  ];

  return (
    <div className="space-y-6">
      {/* Section header */}
      <div className="text-center space-y-2">
        <h2 className="text-3xl font-orbitron font-bold text-foreground">
          Report Center
        </h2>
        <p className="text-muted-foreground font-rajdhani">
          Download your AI-generated reports
        </p>
      </div>

      {/* Report cards */}
      <div className="grid md:grid-cols-2 gap-6">
        {reports.map((report, index) => {
          const Icon = report.icon;
          
          return (
            <GlassCard 
              key={index} 
              variant={`neon-${report.color}`}
              className="text-center"
            >
              <div className="space-y-4">
                <div className={`w-16 h-16 mx-auto rounded-xl bg-neon-${report.color}/20 border border-neon-${report.color}/30 flex items-center justify-center`}>
                  <Icon className={`w-8 h-8 text-neon-${report.color}`} />
                </div>
                
                <div>
                  <h3 className="font-orbitron text-lg text-foreground">{report.title}</h3>
                  <p className="text-sm text-muted-foreground font-rajdhani mt-1">
                    {report.description}
                  </p>
                </div>

                <div className="text-xs text-muted-foreground">
                  Format: {report.format}
                </div>

                <NeonButton
                  variant={report.color}
                  size="sm"
                  className="w-full"
                  onClick={() => handleDownload(report.type)}
                >
                  <Download className="w-4 h-4 mr-2" />
                  Download
                </NeonButton>
              </div>
            </GlassCard>
          );
        })}
      </div>

      {/* Disclaimer */}
      <GlassCard className="text-center py-4">
        <p className="text-sm text-muted-foreground font-rajdhani">
          Reports are generated with your specific application data
        </p>
      </GlassCard>
    </div>
  );
};

export default ReportCenter;
